import"https://esm.sh/date-fns";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function r(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?s.credentials="include":e.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(e){if(e.ep)return;e.ep=!0;const s=r(e);fetch(e.href,s)}})();function v(t,n){t.addEventListener("keydown",r=>{if(r.key==="Enter"){const o=t.value;n(o)}})}const h={apiUrl:"http://djivan.me:3100",habitsOrder:["vitamins","pimsleur","huel","teeth"],habitsEmojis:{vitamins:"ðŸ’Š",pimsleur:"ðŸ‡®ðŸ‡¹",huel:"ðŸ¥¤",teeth:"ðŸ¦·"}};function b(t){console.log(t)}const{apiUrl:C}=h;async function T(t){let n=t.value.trim();const r=`${C}/generate_api_key?password=${n}`,o=await fetch(r,{method:"POST"});if(!o.ok){if(o.status===401)return t.value="",t.placeholder="Wrong password",null;{const a=`HTTP error! status: ${o.status}`;return console.error("Fetch error:",a),null}}return(await o.json()).api_key}async function S(t,n){const r=encodeURIComponent(n),o=`${C}/get_habits?prev=${t}&next=0&key=${r}`;b(`Fetching data from: ${o}`);try{const e=await fetch(o);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const s=await e.json();return b("Data fetched successfully:"),s}catch(e){console.error(`Fetch error: ${e.message}`)}}async function k(t,n){const r=encodeURIComponent(n),o=`${C}/update_habits?key=${r}&habits=${JSON.stringify(t)}`;try{const e=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const s=await e.json();console.log("Response from server: ",s)}catch(e){console.error("Error pushing data to server: ",e)}}function D(t){const n=document.createElement("tr"),r=document.createElement("th");return r.textContent="Habits",r.classList.add("habit-cell"),n.appendChild(r),t.forEach(o=>{const e=document.createElement("th"),s=document.createElement("div");s.className="date-header";const a=new Date(o),c=a.toLocaleString("en-US",{month:"short"}),i=a.getDate(),d=a.toLocaleString("en-US",{weekday:"short"}),f=document.createElement("div");f.className="month",f.textContent=c;const w=document.createElement("div");w.className="day",w.textContent=i;const y=document.createElement("div");y.className="weekday",y.textContent=d,s.appendChild(f),s.appendChild(w),s.appendChild(y),e.appendChild(s),new Date().toISOString().split("T")[0]===o&&e.classList.add("today"),n.appendChild(e)}),n}function O(t,n,r){const o=document.createElement("tr"),e=document.createElement("td");return t in h.habitsEmojis?e.textContent=h.habitsEmojis[t]+"  "+t:e.textContent=t,e.classList.add("habit-cell"),o.appendChild(e),n.forEach(s=>{const a=x(s,t,r);new Date().toISOString().split("T")[0]===s&&a.classList.add("today"),o.appendChild(a)}),o}function P(t,n,r){if(!t){console.error("Table with ID not found.");return}t.innerHTML="";const o=Object.keys(n).sort(),e=D(o);t.appendChild(e),r.forEach(s=>{const a=O(s,o,n);t.appendChild(a)})}function x(t,n,r){let o=r[t][n];const e=document.createElement("td");return typeof o=="boolean"?N(e,o,t,n,r):typeof o=="number"&&$(e,o,t,n,r),e}function N(t,n,r,o,e){t.classList.add("boolean");const s=()=>{const c=document.createElementNS("http://www.w3.org/2000/svg","svg");c.setAttribute("xmlns","http://www.w3.org/2000/svg"),c.setAttribute("viewBox","0 0 24 24"),c.setAttribute("width","24"),c.setAttribute("height","24");const i=document.createElementNS("http://www.w3.org/2000/svg","path");return i.setAttribute("d","M21.03 5.72a.75.75 0 0 1 0 1.06l-11.5 11.5a.747.747 0 0 1-1.072-.012l-5.5-5.75a.75.75 0 1 1 1.084-1.036l4.97 5.195L19.97 5.72a.75.75 0 0 1 1.06 0Z"),c.appendChild(i),c},a=()=>{t.innerHTML="",n?(t.appendChild(s()),t.classList.add("checked-cell")):t.classList.remove("checked-cell")};a(),t.addEventListener("click",()=>{n=!n,e[r][o]=n,a(),g()})}function $(t,n,r,o,e){t.classList.add("number-cell");const s=document.createElement("span");s.textContent=n,t.appendChild(s);const a=()=>{n!==0?t.classList.add("non-zero-cell"):t.classList.remove("non-zero-cell")};a();const c=E("-","decrement-button"),i=E("+","increment-button");c.addEventListener("click",d=>{d.stopPropagation(),n>0&&(n--,e[r][o]=n,s.textContent=n,a(),g())}),i.addEventListener("click",d=>{d.stopPropagation(),n++,e[r][o]=n,s.textContent=n,a(),g()}),t.appendChild(c),t.appendChild(i)}function E(t,n){const r=document.createElement("span");return r.textContent=t,r.className=n,r}let p="",m={},u;const{habitsOrder:H}=h;function g(){u&&(clearTimeout(u),u=null),u=setTimeout(()=>{console.log("5 seconds elapsed"),k(m,p)},5e3)}document.querySelector("#app").innerHTML=`
  <div class ="container">
    <h1>Simple API Dashboard</h1>
    <p id="subtitle">Dashboard to track my habits</p>  
    <input type="password" id="passwordInput" placeholder="Enter password">
    <table id="dataTable"></table>
  </div>
`;const l=document.querySelector("#passwordInput"),L=document.getElementById("dataTable");v(l,async t=>{console.log("Password updated!"),p=await T(l),p&&(console.log("Password accepted!"),l.classList.add("hidden"),setTimeout(()=>{l.style.display="none"},500),m=await S(-6,p),console.log(m),P(L,m,H),L.classList.add("visible"))});document.addEventListener("DOMContentLoaded",()=>{console.log("Page was loaded and DOM content parsed!"),l.focus()});
